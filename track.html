<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Перенаправление</title>
    <!-- Подключаем UAParser.js для анализа User-Agent -->
    <script src="https://cdn.jsdelivr.net/npm/ua-parser-js@1/dist/ua-parser.min.js"></script>
</head>
<body>
    <p>Перенаправление...</p>

    <script>
        // Функция сбора данных
        async function collectVisitorData() {
            const data = {
                timestamp: new Date().toISOString(),
                url: window.location.href,
                referrer: document.referrer,
                language: navigator.language,
                screen: {
                    width: screen.width,
                    height: screen.height,
                    pixelDepth: screen.pixelDepth,
                    availWidth: screen.availWidth,
                    availHeight: screen.availHeight
                },
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };

            // Парсинг User-Agent (устройство, ОС, браузер)
            const parser = new UAParser();
            const uaResult = parser.getResult();
            data.device = {
                userAgent: navigator.userAgent,
                device: uaResult.device, // Например, {model: 'iPhone', vendor: 'Apple'}
                os: uaResult.os,        // Например, {name: 'iOS', version: '15.0'}
                browser: uaResult.browser // Например, {name: 'Chrome', version: '100'}
            };

            // Получение IP и геолокации через ipapi.co
            try {
                const geoResponse = await fetch('https://ipapi.co/json/');
                const geoData = await geoResponse.json();
                data.ip = geoData.ip;
                data.geo = {
                    country: geoData.country_name,
                    region: geoData.region,
                    city: geoData.city,
                    latitude: geoData.latitude,
                    longitude: geoData.longitude,
                    timezone: geoData.timezone
                };
            } catch (error) {
                console.log('Ошибка получения IP/гео:', error);
                data.ip = 'unknown';
                data.geo = 'unknown';
            }

            // Отправляем данные на сервер
            try {
                await fetch('/api/track', { // Замени на свой endpoint
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                console.log('Данные отправлены!');
            } catch (error) {
                console.log('Ошибка отправки:', error);
            }

            // Перенаправление на целевой сайт
            window.location.href = 'authorized.html'; // Замени на нужный URL
        }

        // Запускаем при загрузке страницы
        window.addEventListener('load', collectVisitorData);
    </script>
</body>
</html>
